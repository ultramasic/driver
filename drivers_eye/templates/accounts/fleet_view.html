<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    {% load static %}
    <title>Fleet View</title>
    <script src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&callback=initMap" async
        defer></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>

<body>
    <div class="container">
        <aside class="sidebar">
            <div class="logo">
                <img src="https://cdn.builder.io/api/v1/image/assets%2F444142b2cae54a19aeb8b5ba245feffe%2F731e54a1af7f4f2597adac0a0587d5ce"
                    alt="Driver's Eye Logo">
                <div class="logo-text">Driver's <span>Eye</span></div>
            </div>
            <nav class="nav-group">
                <a href="#" class="nav-item">
                    <img src="https://cdn.builder.io/api/v1/image/assets%2F444142b2cae54a19aeb8b5ba245feffe%2F731e54a1af7f4f2597adac0a0587d5ce"
                        alt="Groups">
                    Groups
                </a>
                <a href="#" class="nav-item active">
                    <img src="https://cdn.builder.io/api/v1/image/assets%2F444142b2cae54a19aeb8b5ba245feffe%2F731e54a1af7f4f2597adac0a0587d5ce"
                        alt="Fleet View">
                    Fleet View
                </a>
                <a href="#" class="nav-item">
                    <img src="https://cdn.builder.io/api/v1/image/assets%2F444142b2cae54a19aeb8b5ba245feffe%2F731e54a1af7f4f2597adac0a0587d5ce"
                        alt="Vehicles">
                    Vehicles
                </a>
                <a href="#" class="nav-item">
                    <img src="https://cdn.builder.io/api/v1/image/assets%2F444142b2cae54a19aeb8b5ba245feffe%2F731e54a1af7f4f2597adac0a0587d5ce"
                        alt="Drivers">
                    Drivers
                </a>
                <a href="#" class="nav-item">
                    <img src="https://cdn.builder.io/api/v1/image/assets%2F444142b2cae54a19aeb8b5ba245feffe%2F731e54a1af7f4f2597adac0a0587d5ce"
                        alt="Assets">
                    Assets
                </a>
                <a href="#" class="nav-item">
                    <img src="https://cdn.builder.io/api/v1/image/assets%2F444142b2cae54a19aeb8b5ba245feffe%2F731e54a1af7f4f2597adac0a0587d5ce"
                        alt="Safety">
                    Safety
                </a>
                <a href="#" class="nav-item">
                    <img src="https://cdn.builder.io/api/v1/image/assets%2F444142b2cae54a19aeb8b5ba245feffe%2F731e54a1af7f4f2597adac0a0587d5ce"
                        alt="Compliance">
                    Compliance
                </a>
                <a href="#" class="nav-item">
                    <img src="https://cdn.builder.io/api/v1/image/assets%2F444142b2cae54a19aeb8b5ba245feffe%2F731e54a1af7f4f2597adac0a0587d5ce"
                        alt="Fuel">
                    Fuel
                </a>
                <a href="#" class="nav-item">
                    <img src="https://cdn.builder.io/api/v1/image/assets%2F444142b2cae54a19aeb8b5ba245feffe%2F731e54a1af7f4f2597adac0a0587d5ce"
                        alt="Maintenance">
                    Maintenance
                </a>
                <a href="#" class="nav-item">
                    <img src="https://cdn.builder.io/api/v1/image/assets%2F444142b2cae54a19aeb8b5ba245feffe%2F731e54a1af7f4f2597adac0a0587d5ce"
                        alt="Customers">
                    Customers
                </a>
                <a href="#" class="nav-item">
                    <img src="https://cdn.builder.io/api/v1/image/assets%2F444142b2cae54a19aeb8b5ba245feffe%2F731e54a1af7f4f2597adac0a0587d5ce"
                        alt="Load Board">
                    Load Board
                </a>
                <a href="#" class="nav-item">
                    <img src="https://cdn.builder.io/api/v1/image/assets%2F444142b2cae54a19aeb8b5ba245feffe%2F731e54a1af7f4f2597adac0a0587d5ce"
                        alt="Dispatch">
                    Dispatch
                </a>
            </nav>
            <nav class="nav-group">
                <a href="#" class="nav-item">
                    <img src="https://cdn.builder.io/api/v1/image/assets%2F444142b2cae54a19aeb8b5ba245feffe%2F731e54a1af7f4f2597adac0a0587d5ce"
                        alt="Messages">
                    Messages
                </a>
                <a href="#" class="nav-item">
                    <img src="https://cdn.builder.io/api/v1/image/assets%2F444142b2cae54a19aeb8b5ba245feffe%2F731e54a1af7f4f2597adac0a0587d5ce"
                        alt="Documents">
                    Documents
                </a>
                <a href="#" class="nav-item">
                    <img src="https://cdn.builder.io/api/v1/image/assets%2F444142b2cae54a19aeb8b5ba245feffe%2F731e54a1af7f4f2597adac0a0587d5ce"
                        alt="Reports">
                    Reports
                </a>
            </nav>
            <div class="sidebar-footer">
                <img src="https://cdn.builder.io/api/v1/image/assets%2F444142b2cae54a19aeb8b5ba245feffe%2F731e54a1af7f4f2597adac0a0587d5ce"
                    alt="Settings">
                <img src="https://cdn.builder.io/api/v1/image/assets%2F444142b2cae54a19aeb8b5ba245feffe%2F731e54a1af7f4f2597adac0a0587d5ce"
                    alt="Notifications">
                <img src="https://cdn.builder.io/api/v1/image/assets%2F444142b2cae54a19aeb8b5ba245feffe%2F731e54a1af7f4f2597adac0a0587d5ce"
                    alt="Help">
                <img src="https://cdn.builder.io/api/v1/image/assets%2F444142b2cae54a19aeb8b5ba245feffe%2F731e54a1af7f4f2597adac0a0587d5ce"
                    alt="User Profile">
            </div>
        </aside>
        <main class="main-content">
            <header class="header">
                <h1>Fleet View</h1>
                <button class="add-entity-btn">
                    <img src="https://cdn.builder.io/api/v1/image/assets%2F444142b2cae54a19aeb8b5ba245feffe%2F731e54a1af7f4f2597adac0a0587d5ce"
                        alt="Add">
                    Add an Entity
                </button>
            </header>
            <div class="tabs">
                <div class="tab active">Map</div>
                <div class="tab">Vehicles</div>
                <div class="tab">Drivers</div>
                <div class="tab">Assets</div>
                <div class="tab">Trips</div>
            </div>

            <div class="content">
                <div class="list-view-tab">
                <section class="list-view">
                    <div class="search-bar">
                        <input type="text" class="search-input" placeholder="Search for vehicles">
                        <button class="filter-btn">Filter</button>
                    </div>
                    <ul class="vehicle-list">
                        {% for truck in trucks %}
                        <li class="vehicle-item">
                            <div class="vehicle-header">
                                <span class="vehicle-name">
                                    <td class="vehicle-status">
                                        {% if truck.status == "active" %}
                                        <img src="{% static 'images/direction_icon.svg' %}" alt="Direction" />
                                        {% elif truck.status == "idle" %}
                                        <img src="{% static 'images/idle.svg' %}" alt="Direction" />
                                        {% elif truck.status == "offline" %}
                                        <img src="{% static 'images/offline.svg' %}" alt="Direction" />
                                        {% else %}
                                        <img src="{% static 'images/maintenance.svg' %}" alt="Direction" />
                                        {% endif %}
                                    </td>
                                    {{ truck.license_plate }}
                                </span>
                                <span class="vehicle-make">
                                    {{ truck.make }}
                                </span>
                                <span class="vehicle-status">Live</span>
                            </div>
                            <div class="vehicle-details">
                                <p>Driver: {{ truck.driver }} {{ truck.driver.drivers_license_number }}</p>
                                <p>Location: {{ truck.gps_data }}</p>
                                <p>Fuel Capacity: {{ truck.fuel_tank_capacity }}</p>
                            </div>
                        </li>
                        {% endfor %}
                    </div>
                </section>

                    <div class="map-section">
                        <section class="map-view">
                            <div id="map"></div>
                        </section>
                    </div>
                        
                        


            
<script>

function initMap() {
    var options = {
        zoom: 8,
        center: { lat: 40.441152, lng: 49.885427 },
        disableDefaultUI: true, // Default to Baku
        mapTypeControl: false,
        styles: [
                {
                    featureType: "poi",
                    stylers: [{ visibility: "off" }]  // Remove points of interest
                },
                {
                    featureType: "transit",
                    elementType: "labels.icon",
                    stylers: [{ visibility: "off" }]  // Remove transit icons
                }
            ]
    };
    var map = new google.maps.Map(document.getElementById('map'), options);

    $.ajax({
        type: 'GET',
        url: '{{ truck_data_url }}',  // Use the full URL passed from the view
        dataType: 'json',
        success: function (data) {
            data.forEach(function (truck) {
                var marker = new google.maps.Marker({
                    position: { lat: truck.lat, lng: truck.lng },
                    map: map,
                    title: truck.name,
                    icon: '{% static "images/direction_icon.svg" %}'  // Correct path to custom icon
                });

                var infoWindowContent = `
                            <div>
                                <h3>${truck.name}</h3>
                                <p><strong>Speed:</strong> ${truck.speed}</p>
                                <p><strong>Fuel level:</strong> ${truck.fuel_level}</p>
                                <p><strong>Driver:</strong> ${truck.driver}</p>
                            </div>
                                            `;

                var infoWindow = new google.maps.InfoWindow({
                    content: infoWindowContent
                });

                marker.addListener('mouseover', function () {
                    infoWindow.open(map, marker);
                });

                marker.addListener('mouseout', function () {
                    infoWindow.close();
                });
            });
        },
        error: function (xhr, status, error) {
            console.error('AJAX Error: ' + status + ' ' + error);
        }
    });
}

// Fallback Debugging
$(document).ready(function () {
    console.log("Document is ready");
    initMap();
});
</script>
</body>

</html>